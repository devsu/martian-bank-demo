openapi: 3.0.3
info:
  title: ATM Locator Service API
  description: |
    API documentation for the atm-locator microservice of Martian Bank.
    This service provides endpoints to discover ATM locations, retrieve ATM details,
    and add new ATM entries to the system.
  version: 1.0.0
  contact:
    name: Cisco Open
  license:
    name: BSD-style
    url: https://opensource.org/licenses/BSD-3-Clause

servers:
  - url: http://localhost:8001
    description: Local development server
  - url: http://localhost:8080
    description: NGINX proxy server

tags:
  - name: ATM
    description: ATM location and management operations

paths:
  /api/atm:
    post:
      summary: Get list of ATMs
      description: |
        Returns a list of up to 4 randomly selected ATMs based on the provided filters.
        By default, returns non-interplanetary ATMs. Results are shuffled on each request.
      operationId: getATMs
      tags:
        - ATM
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetATMsRequest'
            examples:
              allATMs:
                summary: Get all non-interplanetary ATMs
                value: {}
              openOnly:
                summary: Get only currently open ATMs
                value:
                  isOpenNow: true
              interplanetary:
                summary: Get interplanetary ATMs
                value:
                  isInterPlanetary: true
              openInterplanetary:
                summary: Get open interplanetary ATMs
                value:
                  isOpenNow: true
                  isInterPlanetary: true
      responses:
        '200':
          description: List of ATMs successfully retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ATMListItem'
                maxItems: 4
              example:
                - _id: "507f1f77bcf86cd799439011"
                  name: "Martian Bank ATM - Downtown"
                  coordinates:
                    latitude: 37.7749
                    longitude: -122.4194
                  address:
                    street: "123 Main St"
                    city: "San Francisco"
                    state: "CA"
                    zip: "94102"
                  isOpen: true
        '404':
          description: No ATMs found matching the criteria
          content:
            application/json:
              schema:
                type: string
              example: "No ATMs found"

  /api/atm/add:
    post:
      summary: Add a new ATM
      description: |
        Creates a new ATM entry in the database. All required fields must be provided.
        This endpoint is intended for administrative use.
      operationId: addATM
      tags:
        - ATM
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddATMRequest'
            example:
              name: "Martian Bank ATM - Financial District"
              street: "456 Market St"
              city: "San Francisco"
              state: "CA"
              zip: "94103"
              latitude: 37.7899
              longitude: -122.4014
              monFri: "9:00 AM - 6:00 PM"
              satSun: "10:00 AM - 4:00 PM"
              holidays: "Closed"
              atmHours: "24/7"
              numberOfATMs: 3
              isOpen: true
              interPlanetary: false
      responses:
        '201':
          description: ATM successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ATMFull'
              example:
                _id: "507f1f77bcf86cd799439012"
                name: "Martian Bank ATM - Financial District"
                address:
                  street: "456 Market St"
                  city: "San Francisco"
                  state: "CA"
                  zip: "94103"
                coordinates:
                  latitude: 37.7899
                  longitude: -122.4014
                timings:
                  monFri: "9:00 AM - 6:00 PM"
                  satSun: "10:00 AM - 4:00 PM"
                  holidays: "Closed"
                atmHours: "24/7"
                numberOfATMs: 3
                isOpen: true
                interPlanetary: false
                createdAt: "2024-01-15T10:30:00.000Z"
                updatedAt: "2024-01-15T10:30:00.000Z"
                __v: 0
        '404':
          description: Could not create ATM
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                message: "Could not create ATM"
                stack: null
        '500':
          description: Server error or validation failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                message: "ATM validation failed: name: Path `name` is required."
                stack: null

  /api/atm/{id}:
    get:
      summary: Get ATM by ID
      description: |
        Retrieves detailed information for a specific ATM by its MongoDB ObjectId.
        Returns operational details including coordinates, timings, and availability.
      operationId: getSpecificATM
      tags:
        - ATM
      parameters:
        - name: id
          in: path
          description: MongoDB ObjectId of the ATM
          required: true
          schema:
            type: string
            pattern: '^[a-fA-F0-9]{24}$'
          example: "507f1f77bcf86cd799439011"
      responses:
        '200':
          description: ATM details successfully retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ATMDetails'
              example:
                coordinates:
                  latitude: 37.7749
                  longitude: -122.4194
                timings:
                  monFri: "9:00 AM - 6:00 PM"
                  satSun: "10:00 AM - 4:00 PM"
                  holidays: "Closed"
                atmHours: "24/7"
                numberOfATMs: 2
                isOpen: true
        '404':
          description: ATM not found
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ATMNotFoundResponse'
                  - $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: ATM not found
                  value:
                    message: "ATM information not found"
                invalidId:
                  summary: Invalid ObjectId format
                  value:
                    message: "Resource not found"
                    stack: null

components:
  schemas:
    GetATMsRequest:
      type: object
      description: Filter options for ATM search
      properties:
        isOpenNow:
          type: boolean
          description: Filter to return only currently open ATMs
          default: false
        isInterPlanetary:
          type: boolean
          description: Filter to return interplanetary ATMs instead of Earth-based ATMs
          default: false

    AddATMRequest:
      type: object
      description: Request body for creating a new ATM
      required:
        - name
        - street
        - city
        - state
        - zip
        - latitude
        - longitude
        - monFri
        - satSun
        - atmHours
        - numberOfATMs
        - isOpen
        - interPlanetary
      properties:
        name:
          type: string
          description: Name or identifier of the ATM location
          minLength: 1
          example: "Martian Bank ATM - Downtown"
        street:
          type: string
          description: Street address of the ATM
          minLength: 1
          example: "123 Main St"
        city:
          type: string
          description: City where the ATM is located
          minLength: 1
          example: "San Francisco"
        state:
          type: string
          description: State or province code
          minLength: 1
          example: "CA"
        zip:
          type: string
          description: Postal/ZIP code
          minLength: 1
          example: "94102"
        latitude:
          type: number
          format: double
          description: Geographic latitude coordinate
          minimum: -90
          maximum: 90
          example: 37.7749
        longitude:
          type: number
          format: double
          description: Geographic longitude coordinate
          minimum: -180
          maximum: 180
          example: -122.4194
        monFri:
          type: string
          description: Operating hours for Monday through Friday
          example: "9:00 AM - 6:00 PM"
        satSun:
          type: string
          description: Operating hours for Saturday and Sunday
          example: "10:00 AM - 4:00 PM"
        holidays:
          type: string
          description: Operating hours on holidays (optional)
          example: "Closed"
        atmHours:
          type: string
          description: ATM machine availability hours
          example: "24/7"
        numberOfATMs:
          type: integer
          description: Number of ATM machines at this location
          minimum: 1
          example: 2
        isOpen:
          type: boolean
          description: Whether the ATM location is currently operational
          example: true
        interPlanetary:
          type: boolean
          description: Whether this is an interplanetary ATM location
          default: false
          example: false

    ATMListItem:
      type: object
      description: ATM summary returned in list queries
      properties:
        _id:
          type: string
          description: MongoDB ObjectId
          pattern: '^[a-fA-F0-9]{24}$'
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          description: Name or identifier of the ATM location
          example: "Martian Bank ATM - Downtown"
        coordinates:
          $ref: '#/components/schemas/Coordinates'
        address:
          $ref: '#/components/schemas/Address'
        isOpen:
          type: boolean
          description: Whether the ATM location is currently operational
          example: true

    ATMDetails:
      type: object
      description: Detailed ATM information returned for specific ATM queries
      properties:
        coordinates:
          $ref: '#/components/schemas/Coordinates'
        timings:
          $ref: '#/components/schemas/Timings'
        atmHours:
          type: string
          description: ATM machine availability hours
          example: "24/7"
        numberOfATMs:
          type: integer
          description: Number of ATM machines at this location
          example: 2
        isOpen:
          type: boolean
          description: Whether the ATM location is currently operational
          example: true

    ATMFull:
      type: object
      description: Complete ATM object as stored in database
      properties:
        _id:
          type: string
          description: MongoDB ObjectId
          pattern: '^[a-fA-F0-9]{24}$'
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          description: Name or identifier of the ATM location
          example: "Martian Bank ATM - Downtown"
        address:
          $ref: '#/components/schemas/Address'
        coordinates:
          $ref: '#/components/schemas/Coordinates'
        timings:
          $ref: '#/components/schemas/Timings'
        atmHours:
          type: string
          description: ATM machine availability hours
          example: "24/7"
        numberOfATMs:
          type: integer
          description: Number of ATM machines at this location
          example: 2
        isOpen:
          type: boolean
          description: Whether the ATM location is currently operational
          example: true
        interPlanetary:
          type: boolean
          description: Whether this is an interplanetary ATM location
          example: false
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the ATM was created
          example: "2024-01-15T10:30:00.000Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the ATM was last updated
          example: "2024-01-15T10:30:00.000Z"
        __v:
          type: integer
          description: MongoDB version key
          example: 0

    Address:
      type: object
      description: Physical address of the ATM
      required:
        - street
        - city
        - state
        - zip
      properties:
        street:
          type: string
          description: Street address
          example: "123 Main St"
        city:
          type: string
          description: City name
          example: "San Francisco"
        state:
          type: string
          description: State or province code
          example: "CA"
        zip:
          type: string
          description: Postal/ZIP code
          example: "94102"

    Coordinates:
      type: object
      description: Geographic coordinates of the ATM
      required:
        - latitude
        - longitude
      properties:
        latitude:
          type: number
          format: double
          description: Geographic latitude
          minimum: -90
          maximum: 90
          example: 37.7749
        longitude:
          type: number
          format: double
          description: Geographic longitude
          minimum: -180
          maximum: 180
          example: -122.4194

    Timings:
      type: object
      description: Operating hours for the ATM location
      required:
        - monFri
        - satSun
      properties:
        monFri:
          type: string
          description: Monday through Friday hours
          example: "9:00 AM - 6:00 PM"
        satSun:
          type: string
          description: Saturday and Sunday hours
          example: "10:00 AM - 4:00 PM"
        holidays:
          type: string
          description: Holiday hours (optional)
          example: "Closed"

    ErrorResponse:
      type: object
      description: Standard error response format
      properties:
        message:
          type: string
          description: Error message describing what went wrong
          example: "Resource not found"
        stack:
          type: string
          nullable: true
          description: Stack trace (only included in non-production environments)
          example: null

    ATMNotFoundResponse:
      type: object
      description: Response when ATM is not found
      properties:
        message:
          type: string
          description: Error message
          example: "ATM information not found"
