# ATM-Locator Database Schema

## Overview

The atm-locator service uses **MongoDB** with **Mongoose** ODM for data persistence.

**Source Files:**
- Model: `atm-locator/models/atmModel.js`
- Database Connection: `atm-locator/config/db.js`
- Seed Data: `atm-locator/config/atm_data.json`

## Collection: `atms`

**Collection Name:** `atms` (Mongoose pluralizes the model name "ATM")

### Schema Definition

```javascript
{
  // Basic Information
  name: {
    type: String,
    required: true,
    description: "ATM location name"
  },

  // Address Object
  address: {
    street: {
      type: String,
      required: true,
      description: "Street address"
    },
    city: {
      type: String,
      required: true,
      description: "City name"
    },
    state: {
      type: String,
      required: true,
      description: "State/Province"
    },
    zip: {
      type: String,
      required: true,
      description: "ZIP/Postal code"
    }
  },

  // Geolocation
  coordinates: {
    latitude: {
      type: Number,
      required: true,
      description: "Latitude coordinate for map display"
    },
    longitude: {
      type: Number,
      required: true,
      description: "Longitude coordinate for map display"
    }
  },

  // Operating Hours
  timings: {
    monFri: {
      type: String,
      required: true,
      description: "Monday-Friday business hours"
    },
    satSun: {
      type: String,
      required: true,
      description: "Saturday-Sunday business hours"
    },
    holidays: {
      type: String,
      required: false,
      description: "Holiday hours (optional)"
    }
  },

  // ATM Details
  atmHours: {
    type: String,
    required: true,
    description: "ATM operational hours (e.g., '24 hours')"
  },

  numberOfATMs: {
    type: Number,
    required: true,
    description: "Count of ATM machines at this location"
  },

  isOpen: {
    type: Boolean,
    required: true,
    description: "Current operational status"
  },

  interPlanetary: {
    type: Boolean,
    required: true,
    default: false,
    description: "Indicates if ATM is located on another planet"
  },

  // Timestamps (auto-generated by Mongoose)
  createdAt: {
    type: Date,
    description: "Record creation timestamp"
  },

  updatedAt: {
    type: Date,
    description: "Record last update timestamp"
  },

  __v: {
    type: Number,
    description: "Mongoose version key"
  }
}
```

## Field Reference Table

| Field Path | Type | Required | Default | Description |
|------------|------|----------|---------|-------------|
| `_id` | ObjectId | Auto | Auto-generated | MongoDB document identifier |
| `name` | String | Yes | - | ATM location name |
| `address` | Object | Yes | - | Full address information |
| `address.street` | String | Yes | - | Street address |
| `address.city` | String | Yes | - | City name |
| `address.state` | String | Yes | - | State/Province |
| `address.zip` | String | Yes | - | ZIP/Postal code |
| `coordinates` | Object | Yes | - | Geographic coordinates |
| `coordinates.latitude` | Number | Yes | - | Latitude (decimal degrees) |
| `coordinates.longitude` | Number | Yes | - | Longitude (decimal degrees) |
| `timings` | Object | Yes | - | Business hours information |
| `timings.monFri` | String | Yes | - | Monday-Friday hours |
| `timings.satSun` | String | Yes | - | Saturday-Sunday hours |
| `timings.holidays` | String | No | - | Holiday hours |
| `atmHours` | String | Yes | - | ATM operational hours |
| `numberOfATMs` | Number | Yes | - | Number of ATM machines |
| `isOpen` | Boolean | Yes | - | Current operational status |
| `interPlanetary` | Boolean | Yes | false | Inter-planetary ATM flag |
| `createdAt` | Date | Auto | Current time | Creation timestamp |
| `updatedAt` | Date | Auto | Current time | Last update timestamp |
| `__v` | Number | Auto | 0 | Mongoose version key |

## Database Connection Configuration

### Environment Variables

- **`DB_URL`**: MongoDB connection string (for MongoDB Atlas/Cloud)
  - Format: `mongodb://username:password@host:port/database`
  - Example: `mongodb://root:example@mongo:27017`

- **`DATABASE_HOST`**: Local MongoDB hostname (alternative to DB_URL)
  - Format: `hostname` (port 27017 is assumed)
  - Example: `mongo` or `localhost`

### Connection Logic

1. If `DATABASE_HOST` is set, connects to local MongoDB at `mongodb://${DATABASE_HOST}:27017/`
2. Otherwise, connects using `DB_URL` for MongoDB Atlas/Cloud
3. On successful connection, the database is automatically seeded with sample data

## Data Seeding

**Seed File:** `atm-locator/config/atm_data.json`

On application startup, the database:
1. Drops the existing `atms` collection (if it exists)
2. Inserts 13 sample ATM locations from `atm_data.json`

### Sample Data Locations

| Location Name | City | State | Number of ATMs | Status | Inter-planetary |
|---------------|------|-------|----------------|--------|-----------------|
| Martian ATM (Highway) | Musk City | Mars | 2 | Open | false |
| Martian ATM (Claytor Lake) | Musk City | Mars | 1 | Closed | false |
| Martian ATM (Musk Center) | Musk City | Mars | 4 | Open | false |
| Martian ATM (Rocket Launchpad) | Musk City | Mars | 4 | Open | false |
| Martian ATM (Courthouse) | Musk City | Mars | 3 | Open | false |
| Martian ATM (Theater) | Musk City | Mars | 2 | Closed | false |
| Martian ATM (Oak Hill) | Musk City | Mars | 3 | Open | false |
| Martian ATM (Beckley Main) | Musk City | Mars | 2 | Open | false |
| Martian ATM (The Exchange) | Musk City | Mars | 2 | Open | false |
| Martian ATM (The Flats) | Musk City | Mars | 2 | Closed | false |
| Martian ATM (The Mark) | Musk City | Mars | 1 | Open | false |
| Earthern ATM (Georgia Tech) | Atlanta | Georgia | 4 | Open | **true** |
| Saturn ATM (Mimas Moon) | Mimas | Saturn | 3 | Open | **true** |

## Indexes

No explicit indexes are defined in the schema beyond the default `_id` index.

**Recommended Indexes for Production:**
- `{ "coordinates.latitude": 1, "coordinates.longitude": 1 }` - For geospatial queries
- `{ "isOpen": 1 }` - For filtering by operational status
- `{ "address.city": 1, "address.state": 1 }` - For location-based searches
- `{ "interPlanetary": 1 }` - For filtering inter-planetary ATMs

## Migration Notes for Java Implementation

When migrating to Java (atm-locator-java), consider:

1. **ORM/ODM:** Use Spring Data MongoDB or similar
2. **Entity Class:** Create `ATM` entity with embedded `Address`, `Coordinates`, and `Timings` objects
3. **Repository:** Implement `ATMRepository` interface with query methods
4. **Validation:** Add JSR-303/Jakarta validation annotations
5. **Seed Data:** Implement data initialization using CommandLineRunner or similar
6. **Indexes:** Add `@Indexed` annotations for performance optimization
7. **Geospatial Queries:** Consider using MongoDB's geospatial features for proximity searches

## Example Document

```json
{
  "_id": "64a6f1cc8c1899820dbdf25a",
  "name": "Martian ATM (Highway)",
  "address": {
    "street": "14th Street, Martian Way",
    "city": "Musk City",
    "state": "Mars",
    "zip": "40411"
  },
  "coordinates": {
    "latitude": 37.775,
    "longitude": -81.188
  },
  "timings": {
    "monFri": "9:00 AM - 5:00 PM",
    "satSun": "10:00 AM - 3:00 PM",
    "holidays": "Closed on holidays"
  },
  "atmHours": "24 hours",
  "numberOfATMs": 2,
  "isOpen": true,
  "interPlanetary": false,
  "createdAt": "2023-07-06T16:54:36.220Z",
  "updatedAt": "2023-07-06T16:54:36.220Z",
  "__v": 0
}
```

## Related Documentation

- OpenAPI Specification: `openapi.yaml` (in this directory)
- Node.js Model Implementation: `../../atm-locator/models/atmModel.js`
- Database Connection: `../../atm-locator/config/db.js`
- Seed Data: `../../atm-locator/config/atm_data.json`
